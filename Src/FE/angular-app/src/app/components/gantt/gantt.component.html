<div style="white-space: nowrap; overflow: auto; display: flex; background-color: white;">
    <div class="info">
        @for (col of columns; track col; let idx = $index) {
            <div [style.width]="colWidths[idx]+'px'" style="display: inline-block; overflow: hidden;">
                <div class="header text-align-center" [style.width]="colWidths[idx]+'px'">
                    <div class="date-line" [style.left]="colOffset(idx)"></div>
                    <h4 class="column-display">{{col}}</h4>
                </div>
                <div [style.width]="colWidths[idx]+'px'">
                    @for (item of items; track item) {
                        <div [style.height]="taskHeight+'px'" style="padding-left: 5px; display: flex; align-items: center;" *ngIf="item.display" [ngClass]="{'hover':item.hover}" (mouseenter)="item.hover=true" (mouseleave)="item.hover=false">
                            <!-- tasks column -->
                            <div class="task task-title" style="width: 100%; overflow: hidden; text-overflow: elipsis;" *ngIf="col == GanttColumn.tasks">
                                {{item.title}}
                            <!-- <div style="position: absolute; right: 2px; margin: auto 0; top: 0; bottom: 0; cursor: pointer;" *ngIf="item.hover">&#9998;</div> -->
                            </div>
                            <!-- users column -->
                            <div class="task" *ngIf="col == GanttColumn.users">
                                @for(user of item.assignedTo; track user; let last = $last){
                                    <span class="">{{user.firstName}}<span *ngIf="!last">, </span></span>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
    <div class="chart">
        <div [style.width]="dates.length*columnWidth+'px'">

            <div class="header">
                @for (date of dates; track date; let idx = $index) {
                    <div class="date-line" [style.left]="idx*columnWidth + 'px'"></div>
                    <span class="column-display text-align-center" [style.width]="columnWidth+'px'">{{date}}</span>
                }
            </div>
            @for (item of items; track item) {
                <div [style.height]="taskHeight+'px'" style="display: flex; align-items: center;" *ngIf="item.display" [ngClass]="{'hover':item.hover}" (mouseenter)="item.hover=true" (mouseleave)="item.hover=false">
                    <div class="task" *ngIf="item.display" [ngStyle]="{
                        'left': item.left + 'px',
                        'width': item.width + 'px',
                    }">
                        <div class="task-bar" [ngStyle]="{
                            'background-color': item.color,
                            'height': barHeight+'px'
                        }">
                            @for (user of item.assignedTo; track user; let idx = $index) {
                                <div style="font-size: 11px; color: white; font-weight: 400; text-align: center; border-radius: 50%; background-color: lightsalmon; float: right; margin: auto 1px;" [ngStyle]="{
                                    'height': (barHeight-2)+'px',
                                    'width': (barHeight-2)+'px'
                                }"> A</div>
                            }

                            <!-- Dependenct lines -->
                            @for (dependant of item.dependant; track dependant){
                                <!-- from task to the right -->
                                <div style="position: absolute; right: -10px; background-color: grey; width: 15px; height: 3px;"
                                [style.top]="(barHeight / 2 - 1) + 'px'"></div>
                                <!-- down / up -->
                                <!-- if the dependency start before the task ends put red and down just below task
                                otherwise down to the next task -->
                                <div style="position: absolute; right: -10px; background-color: grey; width: 3px;"
                                [style.height]="(idMap[dependant]-idMap[item.id])*taskHeight+'px'"
                                [style.top]="(barHeight / 2 - 1)+'px'"></div>
                                <div style="position: absolute; background-color: grey; height: 3px;"
                                [style.width]="(items[idMap[dependant]].left - item.left - item.width)+'px'"
                                [style.top]="(barHeight / 2 - 1) + idMap[dependant]*taskHeight+'px'"
                                [style.right]="-(items[idMap[dependant]].left - item.left - item.width + 7)+'px'"></div>
                            }
                            <div style="position: absolute; right: -12px; font-weight: bold; cursor: pointer; align-self: center; text-align: center; background-color: grey; border-radius: 20%;" *ngIf="item.hover">&#10247;</div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>